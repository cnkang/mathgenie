#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# æ£€æŸ¥Node.jsç‰ˆæœ¬
if command -v node >/dev/null 2>&1; then
  NODE_VERSION=$(node --version)
  echo "ğŸ“¦ Node.js version: $NODE_VERSION"
else
  echo "âŒ Node.js not found"
  exit 1
fi

# æ£€æŸ¥pnpmæ˜¯å¦å¯ç”¨
if ! command -v pnpm >/dev/null 2>&1; then
  echo "âŒ pnpm not found. Please install pnpm first."
  exit 1
fi

echo "ğŸ¨ Running format..."
pnpm format

echo "ğŸ§¹ Running lint-staged..."
npx lint-staged

# æ£€æŸ¥æ˜¯å¦æœ‰æœªè§£å†³çš„merge conflicts
echo "ğŸ” Checking for merge conflicts..."
if git diff --check --cached; then
  echo "âœ… No merge conflicts found"
else
  echo "âŒ Merge conflicts detected. Please resolve them first."
  exit 1
fi

# æ£€æŸ¥commit messageæ ¼å¼ï¼ˆå¦‚æœæœ‰staged changesï¼‰
if git diff --cached --quiet; then
  echo "âš ï¸  No staged changes found"
  exit 1
fi

echo "âœ… Pre-commit checks passed!"

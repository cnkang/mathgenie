# Lighthouse CI Configuration
# YAML format for better readability and native support

ci:
  collect:
    url:
      - "http://localhost:4173"
    startServerCommand: "pnpm preview"
    startServerReadyPattern: "Local:.*http://localhost:4173"
    startServerReadyTimeout: 30000
    numberOfRuns: 3
    settings:
      # Chrome flags optimized for CI/headless environments
      # --no-sandbox: Required for most CI environments (Docker, GitHub Actions)
      # --disable-dev-shm-usage: Prevents /dev/shm issues in containers
      # --disable-gpu: Disables GPU acceleration for headless testing
      # --disable-web-security: Allows testing of local files and CORS
      chromeFlags: "--no-sandbox --disable-dev-shm-usage --disable-gpu --disable-web-security"
      preset: "desktop"
      onlyCategories:
        - "performance"
        - "accessibility"
        - "best-practices"
        - "seo"
      skipAudits:
        - "uses-http2"
        - "redirects-http"
        - "uses-long-cache-ttl"
        - "efficient-animated-content"
        - "unused-javascript"
        - "unused-css-rules"

  assert:
    assertions:
      # Category scores
      "categories:performance":
        - "warn"
        - minScore: 0.8
      "categories:accessibility":
        - "error"
        - minScore: 0.9
      "categories:best-practices":
        - "warn"
        - minScore: 0.8
      "categories:seo":
        - "warn"
        - minScore: 0.8

      # Core Web Vitals
      "first-contentful-paint":
        - "warn"
        - maxNumericValue: 2000
      "largest-contentful-paint":
        - "warn"
        - maxNumericValue: 2500
      "cumulative-layout-shift":
        - "warn"
        - maxNumericValue: 0.1
      "total-blocking-time":
        - "warn"
        - maxNumericValue: 300

      # Performance metrics
      "speed-index":
        - "warn"
        - maxNumericValue: 3000
      "interactive":
        - "warn"
        - maxNumericValue: 3000

      # Accessibility requirements (fatal errors)
      "color-contrast": "error"
      "image-alt": "error"
      "label": "error"
      "link-name": "error"
      "button-name": "error"
      "aria-valid-attr": "error"
      "aria-required-attr": "error"

      # Best practices
      "is-on-https": "off" # Skip for local testing
      "uses-responsive-images": "warn"
      "efficient-animated-content": "off"

  upload:
    target: "temporary-public-storage"
    outputDir: ".lighthouseci"
    reportFilenamePattern: "%%PATHNAME%%-%%DATETIME%%-report.%%EXTENSION%%"
